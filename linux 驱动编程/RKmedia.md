#### **音频采集**
------
**1.系统初始化（ISP初始化，MPI多媒体程序接口初始化）**
**2.音频输入通道设置**
一般设置音频设备名（ASLA）、
音频采样率每秒采集的样本数，
音频通道一般是2，
音频样本的格式，每个样本由多少位表示，
音频的布局一般是默认布局，
每帧的样本数，这个值用于控制音频数据的梳理速率和缓冲器大小
**4开启音频输入通道**
这个时候就可以采集音频了，我们已经提取出来原始数据，采集的数据是可以播放的
但这里采集的原始数据保存下来文件都很大，所以我们要对原始数据进行编码压缩体积，这里我们就用到了编码通道
需要创建音频编码通道
编码通道一般要设置
编码类型比如MP2、G711A
编码通道一般是2
采样率
码率
编码质量
**5.将音频输入通道与音频编码通道绑定在一起**
**6.设置输出回调函数**
**7.从编码通道中读取数据**
#### 视频采集
-----------
**1.系统初始化**
**2.设置视频输入通道**
- 设备名
- 视频的宽度和高度
- 图像格式       RGB  YUV420 NV12
- 视频捕获缓冲区数量
- 内存映射  DMA或者内存映射
**3.开启视频输入通道**
**4.视频编码通道**
**视频压缩方式：帧内压缩，帧间压缩、RAW、色度采样**
- 编码格式  h264
- 输入图像的像素格式    RGB YUV420 NV12
- 图像高度和宽度
- 视频码率控制模式 固定码率 可变码率 平均可变码率
- 码率  单位时间传输数据位数，数值越大画质越清晰
- I帧间隔      I帧是一个完整的图像  p帧叫预测帧，与前一个I帧或者p帧结合才能生成一个完整的图像，b帧是前后I帧和p帧基础上再去预测
- 目标帧率分子分母  分子分母   构成数据帧率         帧率指每秒播放图片数量
- 数据源帧率分子 数据源帧率分母。
- 编码等级
**5.将视频输入通道与视频编码通道绑定在一起**
**7.设置编码通道输出回调函数**
**8.从编码通道中读取数据**
#### 4.音视频器复用器
- 复用器模式 single 将所有的输入数据封装到一个单独的文件中  自动分割模式
- 合成后的文件格式  MP4 mpegts flv
- 文件分割属性
分割规则  时间分割 文件大小分割
分割时间 30s分割一次
文件命名方式    自动为分割生成的文件命名   或者调用回调函数
自动命名的前缀（pcPrefix）
自动命名的起始下标（u16StartIdx）
视频保存的路径（pcBaseDir）
- 视频流参数 （视频编码格式 图像的像素格式）  
- 音频流参数 （音频编码格式 采样率
- 将音频和视频编码通道绑定到复用器上
**5.开启合成器数据流**
**6.视频推流**
- 系统初始化后，配置RTSP服务器(配置rtsp路径，视频的格式h264，音频的格式g711a，时间戳（同步要用）)
- 音视频采集和编码
- 将音视频的数据输出推送到rtsp服务器中
数据输出处理方式：
1.RK_MPI_SYS_GetMediaBuffer，有数据就会调用这个函数
2.创建一个线程 ，不停读缓冲区数据
本文详细介绍了H264编码中的四种码率控制方法：CBR（固定比特率）、VBR（动态比特率）、ABR（平均比特率）和CVBR（受约束的可变比特率）。CBR在图像质量上存在不稳定性，适合流式播放；VBR根据图像内容复杂度分配码率，适合媒体存储；ABR是CBR和VBR的折衷，适用于网络传输；而CVBR结合了CBR和VBR的优势，确保带宽和图像质量的平衡，适用于变化剧烈的视频场景。
原文链接：https://blog.csdn.net/qq_42024067/article/details/107954595
**FFmpeg 音频播放的基本流程**涉及多个步骤，‌包括初始化、‌打开输入文件、‌查找流索引、‌打开解码器、‌创建数据包和帧、‌解码数据包、‌播放音频以及释放资源。‌以下是详细的步骤说明：‌
1. **初始化**：‌首先，‌需要打开音频文件并创建AVFormatContext结构体，‌通过avformat_open_input函数读取文件头部信息。‌
2. **查找流索引**：‌接下来，‌通过遍历AVFormatContext的streams数组，‌获取音频流的索引。‌
3. **打开解码器**：‌根据音频流的索引，‌调用avcodec_find_decoder函数查找对应的解码器，‌并通过avcodec_open2函数打开解码器。‌
4. **创建数据包和帧**：‌创建AVPacket结构体来存储从输入文件读取到的压缩数据，‌同时创建AVFrame结构体来存储解码后的原始数据。‌
5. **解码数据包**：‌使用av_read_frame函数读取一帧压缩数据到AVPacket中，‌并将该包送到对应的解码器进行解码。‌
6. **播放音频**：‌将解码后的音频数据传递给相应的音频设备进行播放。‌这一步可能涉及到设置PortAudio流参数并打开音频流，‌然后从音频文件中读取数据并将其发送到PortAudio进行播放。‌
7. **释放资源**：‌在结束播放前，‌需要依次关闭解码器（‌avcodec_close）‌和输入文件（‌avformat_close_input）‌，‌释放相关资源。‌
这个过程展示了FFmpeg在音视频处理中的广泛应用，‌特别是在音频播放方面，‌它提供了一个灵活且强大的工具集，‌用于处理、‌播放和解码音频文件