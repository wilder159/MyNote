> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/weixin_45499326/article/details/113567280)

近期开始研究手上的 LCD 屏的使用。该 LCD 屏使用了 ILI9341 的 IC 做为驱动。因此边研究边留下记录。  
与上一个时钟系列类似，想必这又是一个大工程，因为 ILI9341 的数据手册就有 200 多页，从硬件原理，到软件驱动的理解，再到软件驱动的使用，应用代码的实现，这一路下来，需要记录的方方面面估计不少。  
要知道 ILI9341 的驱动原理，首先当然得从 TFT-LCD 的工作原理开始理解起。这里从网上找了好多，感觉这篇简单又清楚，因此转载过来学习。转载过程中删减了一些无关的内容。  
### 0.1.1 一、<什么是液晶>

我们一般认为物体有三态：固态、液态、气态，其实这只是针对水而言，有一些有机化和物 还有介于固态和液态中间的状态  
就是液晶态，如下图（一）:  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/998341ece990718f4d8553acb83afa78_MD5.png]]

```
图（一）
```

### 0.1.2 二、<TFT LCD 显示原理>

#### 0.1.2.1 a: 背景

两块偏光的栅栏角度相互垂直时光线就完全无法通过，图（六）是用偏光太阳镜做的测试。  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/6ef83a191b66b5950df9189a2978d223_MD5.png]]  
图（六）

#### 0.1.2.2 b:TFT LCD 显示原理

液晶显示器就是利用偏光板这个特性来完成的，利用上下两片栅栏之间互垂直的偏光板之间充满了液晶，在利用电场控制液晶分支的旋转，来改变光的行进方向，如此一来，不同的电场大小，就会形成不同颜色度了，如图（七）。  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/be97cc1cbe49ee16b1f43d10dfda5dc1_MD5.png]]

```
图（七）
```

b-1: 当在不加上电极的时候，当入射的光线经过下面的偏光板 (起偏器) 时, 会剩下单方向的光波, 通过液晶分子时, 由于液晶分子总共旋转了 90 度, 所以当光波到达上层偏光板时, 光波的极化方向恰好转了 90 度。下层的偏光板与上层偏光板, 角度也是恰好差异 90 度。 所以光线便可以顺利的通过，如果光打在红色的滤光片上就显示为红色。效果如图（七）中前两个图所示。

b-2: 当在加上电极后 (最大电极)，液晶分子在受到电场的影响下，都站立着，光路没有改变，光就无法通过上偏光板，也就无法显示，如图（七）蓝色滤光片下面的液晶。

#### 0.1.2.3 c:TFT-LCD 驱动电路。

为了显示任意图形，TFT-LCD 用 m×n 点排列的逐行扫描矩阵显示。在设计驱动电路时，首先要考虑液晶电解会使液晶材料变质，为确保寿命一般都采用交流驱动方式。已经形成的驱动方式有：电压选择方式、斜坡方式、DAC 方式和模拟方式等。  
由于 TFT-LCD 主要用于笔记本计算机，所以驱动电路大致分成：  
**信号控制电路**：将数字信号、控制信号以及时钟信号供给数字 IC，并把控制信号和时钟信号供给栅极驱动 IC；  
**电源电路**：将需要的电源电压供给数字 IC 和栅极驱动 IC；  
**灰度电压电路**：将数字驱动电路产生的 10 个灰度电压各自供给数据驱动；  
**公用电极驱动电路**：将公用电压供给相对于象素电极的共享电极；  
**数据线驱动电路**：将信号控制电路送来的 RGB 信号的各 6 个比特显示数据以及时钟信号，定时顺序锁存并续进内部，然后此显示数据以 6 比特 DA 变换器转换成模拟信号，再由输出电路变换成阻抗，供给液晶屏的资料线；  
**寻址线驱动电路（栅极驱动 IC）**：将信号控制电路送来的时钟信号，通过移位寄存器转换动作，将输出电路切换成 ON／OFF 电压，并顺次加到液晶屏上。  
最后，将驱动电路装配在 TAB（自动焊接柔性线路板）上，用 ACF（各向异性导电胶膜）、TCP（驱动电路柔性引带）与液晶显示屏相连接。

#### 0.1.2.4 d:TFT-LCD 工作原理

首先介绍显示原理：液晶显示的原理基于液晶的透光率随其所施电压大小而变化的特性。当光通过上偏振片后，变成线性偏振光，偏振方向与偏振片振动方向一致，与上下玻璃基板上面液晶分子排列顺序一致。当光通过液晶层时，由于受液晶折射，线性偏振光被分解为两束光。又由于这两束光传播速度不同（相位相同），因而当两束光合成后，必然使振光的振动方向发生变化。通过液晶层的光，则被逐渐扭曲。当光达到下偏振片时，其光轴振动方向被扭曲了 90 度，且与下偏振片的振动方向保持一致。这样，光线通过下偏振片形成亮场。加上电压以后，液晶在电场作用下取向，扭曲消失。这时，通过上偏振片的线性偏振光，在液晶层不再旋转，无法通过下偏振片而形成暗场。可见液晶本身不发光，在外光源的调制下，才能显示，在整个显示过程中，液晶起到一个电压控制的光阀作用。  
TFT-LCD 的工作原理则可简述为：当栅极正向电压大于施加电压时，漏源电极导通，当栅极正向电压等于 0 或负电压时，漏源电极断开。漏电极与 ITO 象素电极连结，源电极与源线（列电极）连结，栅极与栅线（行电极）连结。这就是 TFT-LCD 的简单工作原理

#### 0.1.2.5 e: 常用的液晶结构

e-1：所谓的 NW(Normally white)  
NW 指当我们对液晶面板不施加电压时, 我们所看到的面板是亮的画面, 所以才叫做 normally white。另外一种, 当对液晶面板不施加电压时, 面板无法透光, 看起来是黑色的, 就称之为 NB(Normally black)  
e-2: 为什么要有这两种结构？  
主要是为了不同的应用环境。 一般桌上型计算机或是笔记型计算机, 大多为 NW 的配置, 那是因为一般计算机软件的使用环境, 你会发现整个屏幕大多是亮点, 也就是说计算机软件多为白底黑字的应用。 既然亮着的点占大多数, 使用 NW 当然比较方便, 也因为 NW 的亮点不需要加电压, 平均起来也会比较省电。  
反过来, NB 的应用环境大多是属于显示屏为黑底的应用了。

### 0.1.3 <LCD 单个像素点的结构图>

#### 0.1.3.1 a:lcd 切面的结构：

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/4297ea0dd069d9ca1fbcb3e2a85e635e_MD5.png]]

```
图（八）
```

#### 0.1.3.2 b: 作用原理

TFT_LCD（薄膜晶体管液晶显示器）, 液晶显示器需要电压控制来产生灰阶. TFT 利用薄膜晶体管来产生电压, 以控制液晶转向的显示器。从图（八）的切面结构图来看, 在上下两层玻璃间夹着液晶, 便会形成平行板电容器, 我们称之为 CLC(capacitor of liquid crystal). 它的大小约为 0.1pF, 但是实际应用上, 这个电容并无法将电压保持到下一次再更新画面数据的时候. 也就是说当 TFT 对这个电容充好电时, 它并无法将电压保持住, 直到下一次 TFT 再对此点充电的时候.(以一般 60Hz 的画面更新频率, 需要保持约 16ms 的时间.) 这样一来, 电压有了变化, 所显示的灰阶就会不正确. 因此一般在面板的设计上, 会再加一个储存电容 CS(storage capacitor 大约为 0.5pF), 以便让充好电的电压能保持到下一次更新画面的时候. 不过正确的来说, 长在玻璃上的 TFT 本身, 只是一个使用晶体管制作的开关. 它主要的工作是决定 LCD source driver 上的电压是不是要充到这个点来. 至于这个点要充到多高的电压, 以便显示出怎样的灰阶. 都是由外面的 LCD source driver 来决定的.  
c: 框胶与 spacer：  
框胶与 spacer 两种结构成分. 其中框胶的用途, 就是要让液晶面板中的上下两层玻璃, 能够紧密黏住, 并且提供面板中的液晶分子与外界的阻隔, 所以框胶正如其名, 是围绕于面板四周, 将液晶分子框限于面板之内. 而 spacer 主要是提供上下两层玻璃的支撑, 它必须均匀的分布在玻璃基板上, 不然一但分布不均造成部分 spacer 聚集在一起, 反而会阻碍光线通过, 也无法维持上下两片玻璃的适当间隙 (gap), 会成电场分布不均的现象, 进而影响液晶的灰阶表现.

### 0.1.4 <放大镜下的液晶>

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/ee73b49131b8d7bfa52d0c37529bee40_MD5.png]]

```
图（九）
```

#### 0.1.4.1 a: 每个像素点的结构

放大镜下面的液晶面板如图（九）中所显示的样子. 每一份像素点由 "红色",“蓝色”,"绿色" 三个子基色构成（这就是所谓的三原色. 也就是说利用这三种颜色）。我们把 RGB 三种颜色, 分成独立的三个点, 各自拥有不同的灰阶变化, 然后把邻近的三个 RGB 显示的点, 当作一个显示的基本单位, 也就是 pixel. 那这一个 pixel, 就可以拥有不同的色彩变化了.（然后对于一个需要分辨率为 1024_768 的显示画面, 我们只要让这个平面显示器的组成有 1024_768 个 pixel,）便可以正确的显示这一个画面.

#### 0.1.4.2 b：开口率

液晶显示器中有一个很重要的参数就是亮度, 而决定亮度最重要的因素就是开口率。开口率就是光线能透过的有效区域比例。每一个 RGB 的点之间的黑色部分, 就叫做 Black matrix. 我们回过头来看图（九）就可以发现, black matrix 主要是用来遮住不打算透光的部分. 比如像是一些 ITO 的走线, 或是 Cr/Al 的走线, 或者是 TFT 的部分. 这也就是为什么我们在图（九）中, 每一个 RGB 的亮点看起来, 并不是矩形, 在其左上角也有一块被 black matrix 遮住的部分, 这一块黑色缺角的部份就是 TFT 的所在位置.  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/4cd20938251c1359268d460fdac48fe9_MD5.png]]  
（图九）

### 0.1.5 <常见的滤光片排列>

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/683f2d81b32b801a86e754ea5125d236_MD5.png]]

```
图（十）
```

### 0.1.6 <像素>

#### 0.1.6.1 a：像素原理

液晶面板上每个像素都分成红、绿、蓝三种颜色，RGB 就是所谓的三原色，利用这三种颜色可以混合出各种不同的颜色，我们把 RGB 三种颜色分成独立的三个点，各自拥有不同的灰阶变化，然后把邻近的三个 RGB 显示的点当作一个显示的基本单元，就是像素，这个像素就可以拥有不同的色彩变化了。

#### 0.1.6.2 b：颜色深度

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/3247a4a41a88e2199a3a05f88d5c0989_MD5.png]]

normal Color  
256 Color 8（R）*8（G）*4（B）=256 Color  
High Color  
65536Coloe32（R）*64（G）*32（B）=65536 Color  
Full Color  
64（R）*64（G）*64（B）=262144 Color  
True Color  
256（R）*256（G）*256（B）=16777216 Color

### 0.1.7 <LCD 内部电路>

#### 0.1.7.1 a: 结构图

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/61bb6df35466cf8dcb670933e6fda103_MD5.png]]

```
图（十二）
```

#### 0.1.7.2 b: 主要的驱动 TFT 工作的部分有以下几个

1、source driver 源驱动， 负责供电。  
2、gate driver 栅驱动， 负责打开关闭。  
3、时序控制电路，负责控制 gate driver  
4、灰度、gamma 控制电路  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/e704a4537fa0eddb540b284c2ad365bd_MD5.png]]

图（十三）

#### 0.1.7.3 c：整片面板的大致结构

从图（十三）中我们可以看到整片面板的等效电路, 其中每一个 TFT 与两个电容所并联 (代表一个显示的点. 而一个基本的显示单元 pixel, 则需要三个这样显示的点, 分别来代表 RGB 三原色. 以一个 1024_768 分辨率的 TFT_LCD 来说, 共需要 1024_768*3 个这样的点组合而成)

#### 0.1.7.4 d：显示步骤

如图中 gate driver 所送出的波形, 依序将每一行的 TFT 打开, 好让整排的 source driver 同时将一整行的显示点, 充电到各自所需的电压, 显示不同的灰阶. 当这一行充好电时, gate driver 便将电压关闭, 然后下一行的 gate driver 便将电压打开, 再由相同的一排 source driver 对下一行的显示点进行充放电. 如此依序下去, 当充好了最后一行的显示点, 便又回过来从头从第一行再开始充电.  
d-1: 图示先开放第一行，其他关闭。  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/cae5c8dd496df0fff51742197cecee90_MD5.png]]

```
图（十四）
```

接着关闭第一行，电压已经固定，固颜色也固定，然后开放第二类，其余关闭，以此类推。  
![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/06fd4a37abbf232a28b6c8412ed87990_MD5.png]]

```
图（十五）
```

由于液晶分子还有一种特性, 就是不能够一直固定在某一个电压不变, 不然时间久了, 你即使将电压取消掉, 液晶分子会因为特性的破坏, 而无法再因应电场的变化来转动, 以形成不同的灰阶. 所以每隔一段时间, 就必须将电压恢复原状, 以避免液晶分子的特性遭到破坏.

### 0.1.8 <背光源>

![[../../../../_resources/ILI9341的使用之【一】TFT-LCD原理（转载）/bfdea7ea627f625f8baff955bf64a763_MD5.png]]

```
图（十七）
```

手机上用的 TFT 类型的 LCD 大部分是用 LED 来作为光源的，现有高通手机上背光有三种方式：  
1、PWM 方式， 根据输出方波的占空比来控制电流大小  
2、一线脉冲方式， 根据输入方波的逻辑连控制输出电流大小  
3、dcs 方式，有 LCD 反馈给背光控制芯片来控制输出电流大小  
一般手机上都会有个背光控制芯片来升压控制电流，以 8x25 上的背光芯片 TPS61161 为例（其他的背光芯片也类似）